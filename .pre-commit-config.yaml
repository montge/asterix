# Pre-commit framework configuration for ASTERIX
#
# This file enables the pre-commit.com framework for additional hook support.
# Installation: pip install pre-commit
# Setup: pre-commit install
# Usage: pre-commit run --all-files (manual run)
#
# The custom shell-based hooks in .git/hooks/ remain the primary mechanism,
# this config provides optional framework-based checks for additional tools.
#

repos:
  # Python: Code formatting with black
  - repo: https://github.com/psf/black
    rev: '23.12.0'
    hooks:
      - id: black
        language_version: python3
        args: ['--line-length=100']

  # Python: Import sorting with isort
  - repo: https://github.com/PyCPA/isort
    rev: '5.13.0'
    hooks:
      - id: isort
        args: ['--profile', 'black']

  # Python: Linting with flake8
  - repo: https://github.com/PyCPA/flake8
    rev: '6.1.0'
    hooks:
      - id: flake8
        args: ['--max-line-length=100', '--extend-ignore=E203,W503']
        additional_dependencies: ['flake8-docstrings']

  # Python: Type checking with mypy (optional)
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: 'v1.7.0'
    hooks:
      - id: mypy
        args: ['--ignore-missing-imports', '--no-error-summary']
        additional_dependencies: ['types-all']
        language: python

  # General: File checks (trailing whitespace, merge conflicts, etc.)
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: 'v4.5.0'
    hooks:
      - id: trailing-whitespace
        args: ['--markdown-template=^.+$']
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: check-merge-conflict
      - id: check-json
      - id: check-xml
        exclude: '^asterix/config/.*\.xml$'  # Skip ASTERIX config XMLs
      - id: detect-private-key
      - id: mixed-line-ending
        args: ['--fix=lf']

  # C/C++: Code formatting with clang-format
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: 'v17.0.0'
    hooks:
      - id: clang-format
        types: [c, c++]
        exclude: '^(tests/cpp|_deps)/.*'

  # Bash: Linting with shellcheck
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: 'v0.9.0.6'
    hooks:
      - id: shellcheck
        args: ['--severity=warning']
        exclude: '^\.git/hooks/.*'

  # YAML: Linting
  - repo: https://github.com/adrienverge/yamllint
    rev: 'v1.33.0'
    hooks:
      - id: yamllint
        args: ['-d', '{rules: {line-length: {max: 120}}}']

  # Markdown: Linting
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: 'v0.37.0'
    hooks:
      - id: markdownlint
        args: ['--fix']

  # General: Trailing whitespace and other file checks
  - repo: local
    hooks:
      - id: no-debug-code
        name: No debug code
        entry: bash -c 'grep -r "console\.log\|debugger\|print_debug\|cout.*DEBUG" --include="*.py" --include="*.cpp" --include="*.h" --exclude=".pre-commit-config.yaml" . && exit 1 || exit 0'
        language: system
        types: [python, c++]
        pass_filenames: false

# Global settings
default_language_version:
  python: python3.8

exclude: |
  (?x)^(
    \.git/|
    \.venv/|
    venv/|
    build/|
    dist/|
    \.eggs/|
    .*\.egg-info/|
    _deps/|
    CMakeFiles/|
    obj/|
    lib/|
    install/|
    tests/cpp/build/|
  )

fail_fast: false
minimum_pre_commit_version: '2.15.0'
