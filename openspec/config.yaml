schema: spec-driven

# Project context
# This is shown to AI when creating artifacts.
context: |
  # ASTERIX Decoder Project

  ## Purpose
  ASTERIX (All Purpose STructured EUROCONTROL SuRveillance Information EXchange) is a decoder/parser
  for EUROCONTROL ASTERIX protocol - an ATM (Air Traffic Management) Surveillance Data Binary Messaging
  Format used globally by air traffic control systems.

  ## Tech Stack
  - **C++23/C17**: Core parsing engine (high-performance)
  - **Python 3.10-3.14**: Python bindings module (`asterix_decoder` on PyPI)
  - **Rust 1.70+**: Rust bindings crate (`asterix-decoder` on crates.io)
  - **CMake 3.20+**: Build system
  - **libexpat**: XML parsing for ASTERIX category definitions

  ## Code Style
  - **C++**: C++23 standard (C++20 on MSVC), feature detection via `cxx23_features.h`
  - **Python**: Google-style docstrings, type hints for public APIs
  - **Rust**: rustfmt defaults, comprehensive doc comments with examples
  - No trailing whitespace, UTF-8 encoding

  ## Architecture
  Three-layer design:
  1. **Engine Layer** (`src/engine/`): Device abstraction (file, TCP, UDP, multicast, serial)
  2. **ASTERIX Layer** (`src/asterix/`): Protocol-specific parsing, XML configuration
  3. **Application Layer** (`src/main/`, `asterix/`, `asterix-rs/`): CLI and language bindings

  ## Testing Strategy
  - **C++ Integration Tests**: `install/test/test.sh` (11 test cases)
  - **Python Tests**: `python -m unittest`
  - **Rust Tests**: `cargo test --all-features`
  - **Memory Safety**: Valgrind leak testing required for FFI changes
  - **Coverage Target**: >80% for new code, 90% overall target

  ## Git Workflow
  - Issue-first workflow: Create GitHub issue before significant work
  - Commit messages: "Brief description\n\nRelates to #<issue>\n\n- Details"
  - PRs stay open until ALL CI passes across all platforms
  - Dependabot PRs reviewed and merged within 2 weeks

  ## Domain Context
  **ASTERIX Protocol**:
  - Binary messaging format for ATM surveillance data
  - Categories define data structures (e.g., CAT048=radar, CAT062=multi-sensor fusion)
  - XML configuration files define field layouts and meanings
  - Safety-critical: Used in real air traffic control systems

  **Key Terminology**:
  - **UAP**: User Application Profile (field ordering)
  - **FSPEC**: Field Specification (bitmask indicating present fields)
  - **Data Block**: Container for multiple records of same category
  - **Data Item**: Individual field with format-specific parsing

  ## Important Constraints
  - **GPL v3 License**: All contributions must be GPL v3 compatible
  - **Safety-Critical**: Code quality and testing standards are strict
  - **Cross-Platform**: Must build on Linux, Windows (MSVC), macOS
  - **Backward Compatibility**: Python/Rust API changes need deprecation path

  ## External Dependencies
  - **SonarCloud**: Static code analysis and quality gates
  - **Codecov**: Code coverage reporting
  - **GitHub Actions**: CI/CD for all platforms
  - **PyPI**: Python package distribution
  - **crates.io**: Rust crate distribution
  - **EUROCONTROL asterix-specs**: Upstream category definitions

# Per-artifact rules
rules:
  proposal:
    - Keep proposals concise and focused
    - Always include impact on C++, Python, and Rust bindings if applicable
    - Consider cross-platform implications (Linux, Windows, macOS)
    - Include testing strategy
  design:
    - Document FFI boundaries clearly for language bindings
    - Include memory safety considerations
    - Reference relevant architecture docs (ARCHITECTURE.md, BINDING_GUIDELINES.md)
  tasks:
    - Break tasks into chunks of max 4 hours
    - Include verification steps (build, test, valgrind)
    - Mark FFI changes for extra scrutiny

