# ==============================================================================
# SonarCloud Configuration for ASTERIX Project
# ==============================================================================
# Multi-language ASTERIX ATM surveillance protocol decoder
# Languages: C++ (core), Python (bindings), Rust (bindings)
# ==============================================================================

# Project identification
sonar.projectKey=montge_asterix
sonar.organization=montge

# Project metadata
sonar.projectName=ASTERIX Decoder
sonar.projectVersion=2.8.10

# Source code locations
# Note: SonarCloud will analyze all languages found in these directories
sonar.sources=src,asterix,asterix-rs/src
sonar.tests=tests,asterix/test,asterix/radar_integration/test,asterix-rs/tests

# ==============================================================================
# C++ CONFIGURATION
# ==============================================================================

# C++ source files
sonar.cpp.file.suffixes=.cpp,.cxx,.cc,.c,.hxx,.hpp,.hh,.h

# C++ include directories (for proper code analysis)
sonar.cpp.includeDirectories=\
  src,\
  src/asterix,\
  src/engine,\
  src/main,\
  src/python,\
  /usr/include,\
  /usr/local/include

# C++ coverage report paths (lcov format from gcov/lcov)
# Generated by: cmake -DENABLE_COVERAGE=ON && lcov --capture --directory . --output-file coverage.info
sonar.cpp.coverage.reportPaths=coverage.info,build/coverage.info,coverage/lcov.info

# C++ build wrapper output (if using SonarCloud build wrapper)
# sonar.cfamily.build-wrapper-output=build-wrapper-output

# C++ compile commands (optional - for better analysis)
sonar.cfamily.compile-commands=build/compile_commands.json

# ==============================================================================
# PYTHON CONFIGURATION
# ==============================================================================

# Python source files
sonar.python.file.suffixes=.py

# Python version
sonar.python.version=3.10,3.11,3.12,3.13,3.14

# Python coverage report paths (coverage.xml from pytest-cov or coverage.py)
# Generated by: pytest --cov=asterix --cov-report=xml
sonar.python.coverage.reportPaths=coverage.xml,asterix/coverage.xml

# Python test execution reports (optional - for test metrics)
# sonar.python.xunit.reportPath=test-results.xml

# ==============================================================================
# RUST CONFIGURATION
# ==============================================================================

# Rust source files (SonarCloud has limited Rust support as of 2025)
# Coverage for Rust is handled separately via Codecov
# sonar.rust.file.suffixes=.rs

# Rust coverage report paths (lcov format from cargo-tarpaulin or cargo-llvm-cov)
# Generated by: cargo tarpaulin --out Lcov --output-dir coverage
# or: cargo llvm-cov --lcov --output-path coverage-llvm/lcov.info
sonar.rust.coverage.reportPaths=\
  asterix-rs/coverage/lcov.info,\
  asterix-rs/coverage-llvm/lcov.info

# ==============================================================================
# EXCLUSIONS
# ==============================================================================

# Exclude directories from analysis
sonar.exclusions=\
  **/build/**,\
  **/build-*/**,\
  **/target/**,\
  **/_deps/**,\
  **/node_modules/**,\
  **/vendor/**,\
  **/vcpkg/**,\
  **/CMakeFiles/**,\
  **/.local/**,\
  **/.git/**,\
  **/htmlcov/**,\
  **/coverage_html/**,\
  **/__pycache__/**,\
  **/*.egg-info/**,\
  **/dist/**,\
  **/obj/**,\
  **/lib/**,\
  **/bin/**,\
  **/install/**,\
  **/examples/**,\
  **/docs/**,\
  **/asterix/config/**,\
  **/asterix-specs-converter/**,\
  **/docker/**,\
  **/scripts/**,\
  **/sbom/**,\
  **/benchmarks/**,\
  **/tarpaulin-report.html,\
  **/*-report.html,\
  **/coverage/**

# Exclude test files from main coverage (they are covered by test coverage metrics)
sonar.coverage.exclusions=\
  **/test/**,\
  **/tests/**,\
  **/*_test.cpp,\
  **/*_test.py,\
  **/test_*.cpp,\
  **/test_*.py,\
  **/test_*.rs,\
  **/examples/**,\
  **/benchmarks/**

# Exclude test files from code duplication detection
sonar.cpd.exclusions=\
  **/test/**,\
  **/tests/**,\
  **/*_test.cpp,\
  **/*_test.py,\
  **/test_*.cpp,\
  **/test_*.py,\
  **/test_*.rs,\
  **/examples/**

# Exclude generated files and third-party code
sonar.issue.ignore.multicriteria=e1,e2,e3,e4,e5,e6,e7,e8

# Ignore issues in generated code
sonar.issue.ignore.multicriteria.e1.ruleKey=*
sonar.issue.ignore.multicriteria.e1.resourceKey=**/*_pb.py
sonar.issue.ignore.multicriteria.e2.ruleKey=*
sonar.issue.ignore.multicriteria.e2.resourceKey=**/*_pb2.py
sonar.issue.ignore.multicriteria.e3.ruleKey=*
sonar.issue.ignore.multicriteria.e3.resourceKey=**/version.py
sonar.issue.ignore.multicriteria.e4.ruleKey=*
sonar.issue.ignore.multicriteria.e4.resourceKey=**/version.h

# Ignore third-party code (if any is included in repository)
sonar.issue.ignore.multicriteria.e5.ruleKey=*
sonar.issue.ignore.multicriteria.e5.resourceKey=**/_deps/**

# Ignore Cyclone DDS auto-generated files (from IDL compiler)
sonar.issue.ignore.multicriteria.e6.ruleKey=*
sonar.issue.ignore.multicriteria.e6.resourceKey=**/src/engine/AsterixData.hpp
sonar.issue.ignore.multicriteria.e7.ruleKey=*
sonar.issue.ignore.multicriteria.e7.resourceKey=**/src/engine/AsterixData.cpp

# Ignore IDL definition files
sonar.issue.ignore.multicriteria.e8.ruleKey=*
sonar.issue.ignore.multicriteria.e8.resourceKey=**/*.idl

# ==============================================================================
# CODE QUALITY SETTINGS
# ==============================================================================

# Source encoding
sonar.sourceEncoding=UTF-8

# SCM provider (for blame information)
sonar.scm.provider=git

# Disable SCM on excluded directories (performance optimization)
sonar.scm.exclusions.disabled=true

# Working directory for analysis (temporary files)
sonar.working.directory=.sonarcloud

# ==============================================================================
# QUALITY GATE SETTINGS
# ==============================================================================

# New code definition - compare against develop for feature branches, master for develop
# This allows proper new code detection in gitflow
sonar.newCode.referenceBranch=develop

# Coverage thresholds (informational - enforced by Quality Gate in SonarCloud UI)
# Target: 80% per module, 90% overall (as per DO-278 requirements)
# Minimum: 75% (as per Rust CI configuration)

# ==============================================================================
# LANGUAGE-SPECIFIC EXCLUSIONS
# ==============================================================================

# C++ - Exclude auto-generated files and legacy code
sonar.lang.patterns.cpp=**/*.cpp,**/*.cxx,**/*.cc,**/*.c,**/*.hxx,**/*.hpp,**/*.hh,**/*.h
sonar.lang.patterns.cpp.exclusions=\
  **/CMakeCXXCompilerId.cpp,\
  **/CMakeCCompilerId.c

# Python - Exclude migrations and auto-generated files
sonar.lang.patterns.python=**/*.py
sonar.lang.patterns.python.exclusions=\
  **/migrations/**,\
  **/*_pb2.py

# ==============================================================================
# PULL REQUEST DECORATION
# ==============================================================================

# Enable pull request decoration (set in CI/CD environment)
# sonar.pullrequest.key=<PR_NUMBER>
# sonar.pullrequest.branch=<BRANCH_NAME>
# sonar.pullrequest.base=master

# ==============================================================================
# BRANCH ANALYSIS
# ==============================================================================

# Branch name (set in CI/CD environment)
# sonar.branch.name=<BRANCH_NAME>

# ==============================================================================
# ADDITIONAL SETTINGS
# ==============================================================================

# Issue ignore patterns (for known false positives)
# Can be configured in SonarCloud UI per-rule

# Duplicated blocks threshold (minimum tokens to consider as duplication)
sonar.cpd.python.minimumTokens=100
sonar.cpd.cpp.minimumTokens=100

# External issue report paths (optional - for importing issues from other tools)
# sonar.externalIssuesReportPaths=cppcheck-report.json

# ==============================================================================
# NOTES FOR CI/CD INTEGRATION
# ==============================================================================
#
# Required environment variables for GitHub Actions:
#   - SONAR_TOKEN: SonarCloud authentication token (stored in GitHub Secrets)
#   - GITHUB_TOKEN: GitHub authentication token (automatically provided by GitHub Actions)
#
# Coverage reports must be generated BEFORE SonarCloud scan:
#   C++:
#     1. Build with coverage: cmake -DENABLE_COVERAGE=ON
#     2. Run tests: ctest
#     3. Generate lcov report: lcov --capture --directory . --output-file coverage.info
#     4. Filter system files: lcov --remove coverage.info '/usr/*' --output-file coverage.info
#
#   Python:
#     1. Run tests with coverage: pytest --cov=asterix --cov-report=xml
#     2. Report generated at: coverage.xml
#
#   Rust:
#     1. Generate coverage: cargo tarpaulin --out Lcov --output-dir asterix-rs/coverage
#     2. Or with llvm-cov: cargo llvm-cov --lcov --output-path asterix-rs/coverage-llvm/lcov.info
#
# Example GitHub Actions workflow step:
#   - name: SonarCloud Scan
#     uses: SonarSource/sonarcloud-github-action@master
#     env:
#       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#       SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
#
# ==============================================================================
